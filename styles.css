/* ── Reset & Variables ── */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#1a1a2e;--bg2:#16213e;--bg3:#0f3460;
  --glass:rgba(255,255,255,.06);--glass-border:rgba(255,255,255,.1);
  --text:#e0e0e0;--text-dim:#8a8a9a;--accent:#e94560;
  --green:#00d97e;--yellow:#ffc107;--red:#e94560;
  --sidebar-w:300px;--bottom-h:80px;--urlbar-h:52px;
  --radius:10px;
}
html,body{height:100%;overflow:hidden;font-family:'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--text)}

/* ── Layout ── */
body{display:grid;grid-template-columns:var(--sidebar-w) 1fr;grid-template-rows:1fr var(--bottom-h);grid-template-areas:"sidebar main" "sidebar bottom"}
#sidebar{grid-area:sidebar;display:flex;flex-direction:column;background:var(--bg2);border-right:1px solid var(--glass-border);overflow:hidden}
#main{grid-area:main;display:flex;flex-direction:column;overflow:hidden}
#bottom-bar{grid-area:bottom;background:var(--bg2);border-top:1px solid var(--glass-border);display:flex;flex-direction:column;padding:0 12px;overflow:hidden}

/* ── Sidebar ── */
.sidebar-header{padding:16px;text-align:center;border-bottom:1px solid var(--glass-border)}
.sidebar-header h1{font-size:1.2rem;margin:0}
.sidebar-header .subtitle{font-size:.7rem;color:var(--text-dim)}
.sidebar-tabs{display:flex;border-bottom:1px solid var(--glass-border)}
.tab-btn{flex:1;padding:10px;background:none;border:none;color:var(--text-dim);cursor:pointer;font-size:.85rem;transition:.2s}
.tab-btn.active{color:var(--accent);border-bottom:2px solid var(--accent)}
.tab-content{display:none;flex:1;flex-direction:column;overflow:hidden}
.tab-content.active{display:flex}

/* Chat */
#chat-messages{flex:1;overflow-y:auto;padding:10px;display:flex;flex-direction:column;gap:8px}
.chat-msg{padding:8px 10px;border-radius:var(--radius);font-size:.82rem;max-width:90%;animation:fadeIn .2s}
.chat-msg.user{background:var(--bg3);align-self:flex-end;border-bottom-right-radius:2px}
.chat-msg.system{background:var(--glass);align-self:flex-start;border-bottom-left-radius:2px}
.chat-input-wrap{padding:8px;border-top:1px solid var(--glass-border);display:flex;gap:6px}
#chat-input{flex:1;background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--radius);color:var(--text);padding:8px;resize:none;font-size:.82rem}
.chat-actions{display:flex;flex-direction:column;gap:4px}
.chat-actions button{width:32px;height:32px;border:none;border-radius:var(--radius);background:var(--accent);color:#fff;cursor:pointer;font-size:1rem;transition:.2s}
.chat-actions button:hover{opacity:.8}

/* Annotation list */
.ann-controls{display:flex;gap:6px;padding:8px;border-bottom:1px solid var(--glass-border)}
.ann-controls button{background:var(--glass);border:1px solid var(--glass-border);color:var(--text);border-radius:var(--radius);padding:6px 10px;cursor:pointer;font-size:.85rem;transition:.2s}
.ann-controls button:hover{background:var(--glass-border)}
#annotation-list{flex:1;overflow-y:auto;padding:8px;display:flex;flex-direction:column;gap:6px}
.ann-item{padding:8px;border-radius:var(--radius);border-left:4px solid var(--yellow);background:var(--glass);cursor:pointer;font-size:.8rem;transition:.2s}
.ann-item:hover{background:var(--glass-border)}
.ann-item.high{border-left-color:var(--red)}
.ann-item.low{border-left-color:var(--green)}
.ann-item .ann-meta{color:var(--text-dim);font-size:.7rem;margin-top:4px}

/* ── URL Bar ── */
#url-bar{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--bg2);border-bottom:1px solid var(--glass-border);flex-wrap:wrap;min-height:var(--urlbar-h)}
#url-input{flex:1;min-width:200px;background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--radius);color:var(--text);padding:8px 12px;font-size:.85rem}
#btn-load-url{background:var(--accent);border:none;color:#fff;padding:8px 16px;border-radius:var(--radius);cursor:pointer;font-weight:600;transition:.2s}
#btn-load-url:hover{opacity:.8}
.presets{display:flex;gap:4px}
.preset{background:var(--glass);border:1px solid var(--glass-border);color:var(--text);padding:4px 10px;border-radius:16px;cursor:pointer;font-size:.75rem;transition:.2s;white-space:nowrap}
.preset:hover{background:var(--bg3);border-color:var(--accent)}
.device-toggles{display:flex;gap:4px}
.device-btn{background:var(--glass);border:1px solid var(--glass-border);color:var(--text);padding:4px 8px;border-radius:var(--radius);cursor:pointer;font-size:1rem;transition:.2s}
.device-btn.active{background:var(--accent);border-color:var(--accent)}

/* ── Preview ── */
#preview-container{flex:1;display:flex;justify-content:center;align-items:flex-start;overflow:auto;padding:12px;background:var(--bg)}
#preview-wrapper{position:relative;width:100%;height:100%;transition:width .3s,height .3s;background:#fff;border-radius:var(--radius);overflow:hidden;box-shadow:0 0 40px rgba(0,0,0,.4)}
#preview-iframe{width:100%;height:100%;border:none}
#annotation-overlay{position:absolute;inset:0;width:100%;height:100%;pointer-events:none;z-index:10}
#annotation-overlay .ann-marker{pointer-events:all;cursor:pointer}
#annotation-overlay .ann-pin{pointer-events:all;cursor:move}
#annotation-overlay line{pointer-events:none}
#cors-notice{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(26,26,46,.92);color:var(--text-dim);text-align:center;gap:8px}
#cors-notice p:first-child{font-size:1.2rem}
.hidden{display:none!important}

/* ── Bottom Bar ── */
.bottom-tools{display:flex;gap:8px;padding:8px 0;align-items:center;overflow-x:auto}
.bottom-tools button{background:var(--glass);border:1px solid var(--glass-border);color:var(--text);padding:6px 14px;border-radius:var(--radius);cursor:pointer;font-size:.8rem;white-space:nowrap;transition:.2s}
.bottom-tools button:hover{background:var(--bg3);border-color:var(--accent)}
#upload-dropzone{border:2px dashed var(--glass-border);border-radius:var(--radius);padding:20px;text-align:center;color:var(--text-dim);cursor:pointer;margin:8px 0;transition:.2s}
#upload-dropzone.dragover{border-color:var(--accent);background:rgba(233,69,96,.1)}
#upload-dropzone input{display:none}
#thumbnail-gallery{display:flex;gap:6px;overflow-x:auto;padding:4px 0}
#thumbnail-gallery img{width:48px;height:48px;object-fit:cover;border-radius:6px;cursor:pointer;border:2px solid transparent;transition:.2s}
#thumbnail-gallery img:hover{border-color:var(--accent)}

/* ── Modals ── */
.modal{position:fixed;inset:0;z-index:1000;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);animation:fadeIn .2s}
.modal-content{width:90%;max-width:420px;padding:24px;border-radius:var(--radius)}
.glass{background:rgba(22,33,62,.95);border:1px solid var(--glass-border);backdrop-filter:blur(16px)}
.modal h3{margin-bottom:12px;font-size:1rem}
.modal textarea,.modal select,.modal input[type=text]{width:100%;background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--radius);color:var(--text);padding:8px;font-size:.85rem;margin-bottom:8px}
.modal-row{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.modal-row label{width:60px;font-size:.8rem;color:var(--text-dim)}
.modal-row select{flex:1}
.modal-actions{display:flex;gap:8px;margin-top:12px}
.btn-primary{background:var(--accent);border:none;color:#fff;padding:8px 18px;border-radius:var(--radius);cursor:pointer;font-weight:600}
.btn-secondary{background:var(--glass);border:1px solid var(--glass-border);color:var(--text);padding:8px 18px;border-radius:var(--radius);cursor:pointer}
.btn-danger{background:#c0392b;border:none;color:#fff;padding:8px 18px;border-radius:var(--radius);cursor:pointer}
.img-drop{border:2px dashed var(--glass-border);border-radius:var(--radius);padding:16px;text-align:center;color:var(--text-dim);cursor:pointer;font-size:.8rem;margin-bottom:8px}
.img-drop input{display:none}
#ann-img-preview{max-width:100%;max-height:120px;border-radius:var(--radius);margin-bottom:8px}

/* Lightbox */
#lightbox{z-index:2000;cursor:zoom-out}
#lightbox img{max-width:90vw;max-height:90vh;border-radius:var(--radius)}
#lightbox-close{position:fixed;top:20px;right:20px;background:var(--accent);border:none;color:#fff;width:36px;height:36px;border-radius:50%;font-size:1.2rem;cursor:pointer}

/* Scrollbar */
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--glass-border);border-radius:3px}

@keyframes fadeIn{from{opacity:0}to{opacity:1}}
